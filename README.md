# Express Code Style Guide 

*How to structure your code for Express 4. The purpose of this style guide is to provide guidance on building Express 4 applications by showing conventions that the Social Analytics Frontend team use and why we use them. Hopefully by following this style guide, all team members will find using a consistent code structure helpful.* 


## Table of Contents 

  1. [Philosophy](#philosophy)
  1. [Folder Structure](#structure) 
  1. [Routing](#routing)


## Philosophy 

  - Locating your code is easy and fast.
  - Easy to identify, you will need longer file names, descriptive file names
  - Flat Structure as long as we can. No one wants to search 7 levels of folders to find a file. When a folder has 10 files, that's when it's time to create subfolders. 
  - Try to stay DRY (don't repeat yourself) 
  - Each view, route, page, is in its own file. 
  - All 3rd party vendor files are stored in its own folder. I don't want them cluttering my app.
  

## Folder Structure 

  - **Structure your Express 4 app so it is easy to manage and maintain**

  + How you organize the structure of your app project is always the first step. 
  + Express apps are structured a certain way, which this structure is very difficult to change. If you have to find a specific view, route or css file, they are in different folders. This is a limitation of Express but we can still try to keep our code organized. 
  + You cannot organize your code by "feature". For example, in "Login" you can't put all its css, js, view and route code into a `Login` folder.
  + Keep it flat
  + Only create a folder for common features like "logging, progress bars, etc." 
  + 
  
  - **Keep it Flat** 
  
  - **Overall Folder Structure** 
  
  + Core folders are public, routes and views

  ```javascript 
  /competitor-hunter
    /public
      /images 
      /javascripts
      /stylesheets
      /vendor
    /routes
      /middlewares
    /views
      /layouts
  ```
  - **Public** 
  
  + The `public` folder is where all the "static" files are. This means they are files which are not dynamically generated by the server and sent to the user. These static files require the user to download it from the server the user downloads these static files (css, js and images) from your server. That's why it has to be public because the user must have access to it in order to be able to download it. Files requested by the user.
  + The `images`, `javascripts` and `stylesheets` folders is where your own files go. 
  + The `vendor` folder is for all 3rd party or vendor css or js files. 
  
- **Routes** 

+ All routes reside here. Keep it flat so no need to create a new folder for each part 
+ 

- **Views** 

+ Where the HTML resides. It includes partial views. 
+ We use express-handlebars and
+ Layouts


  - **Naming Conventions**
  
  + Should simply help with finding files and communicating code
  + For views (html), js, or css, you can use this convention: feature dash subfeature. e.g. `facebook-keymetrics.html` which facebook is the feature, keymetrics is the page.





  [More info](http://www.johnpapa.net/angular-growth-structure/)


## Routing

  - **Chainable Route Handlers**

    + Recommended approach to avoid duplicate route names
    + Create chainable route handlers for a route path
    + This is new to Express 4 
    + Since path is specified in a single location, it helps to modularize your routes and improve code structure 
    + Here is example of chained route handlers using `express.router()`:

    ```javascript
    router.route('/book')
      .get(function(req,res) { 
        res.send('get book'); 
      }) 
      .post(function(req,res) {
        res.send('add book'); 
    })
    ```
  - **Use `express.router()` over `app.route()`** 
  
    + Recommended approach to modularize your routes
    + A `express.router()` is a complete middleware and routing system; often referred to as a "mini-app". It can have its own middlware, param and HTTP verb methods. 
    + This is new to Express 4    
    + You can create many `express.router()` which are route instances and use each instance for a specific path, particlular middleware or logic. 
    + Both `app.route()` and `express.router()` can create chainable route handlers.
    + Here is an example of router with middleware specific to this route:
    
    ```javascript
    var express = require('express');
    var router = express.Router();

    // middleware specific to this router
    router.route(function timeLog(req, res, next) {
      console.log('Time: ', Date.now());
      next();
    })
    
    // define the book page route 
    router.route('/book')
      .get(function(req,res) { 
        res.send('get book'); 
      }) 
      .post(function(req,res) {
        res.send('add book'); 
    })

    module.exports = router;
    ```
    
    the router module loaded in app.js 
    
    ```javascript
    var book = require('./routes/book');
    app.use('/', book); 
    ```
